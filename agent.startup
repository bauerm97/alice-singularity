#!/bin/bash
echo 'Using the proxy'
mkdir -p /tmp

export ALIEN_USER=aliprod
export ALIEN_ROOT=/cvmfs/alice.cern.ch/x86_64-2.6-gnu-4.1.2/Packages/AliEn/v2-19-276
export PATH=/u/rgrosso/testAgent:/lustre/nyx/alice/aliprod/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/var/lib/aliprod/bin:$PATH
export HOME=/lustre/nyx/alice/aliprod
export ALIEN_CM_AS_LDAP_PROXY=lxcealice03.gsi.de:8084
export LD_LIBRARY_PATH=/cvmfs/alice.gsi.de/grid/lib:$LD_LIBRARY_PATH
export TERMINFO=/cvmfs/alice.cern.ch/x86_64-2.6-gnu-4.1.2/Packages/AliEn/v2-19-276/share/terminfo
export LIBRARY_PATH=/usr/lib/x86_64-linux-gnu/
export C_INCLUDE_PATH=/usr/include/x86_64-linux-gnu/
export CPLUS_INCLUDE_PATH=/usr/include/x86_64-linux-gnu/
export http_proxy=
export HTTP_PROXY=
export https_proxy=
export HTTPS_PROXY=

x509file=x509up_u3343
proxyfile=/tmp/proxy.$$.`date +%s`
mv $x509file $proxyfile
chmod 0400 $proxyfile
export X509_USER_PROXY=$proxyfile;
echo USING $X509_USER_PROXY
/cvmfs/alice.cern.ch/bin/alienv  -alien -c ALIEN_DEBUG='-d:Trace' alien proxy-info
/cvmfs/alice.cern.ch/bin/alienv  -alien -c ALIEN_DEBUG='-d:Trace' alien RunAgent
rm -rf $proxyfile
